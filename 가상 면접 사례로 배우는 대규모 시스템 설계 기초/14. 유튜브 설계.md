### 기능 목록

- 빠른 비디오 업로드
- 원활한 비디오 재생
- 재생 품질 선택 기능
- 낮은 인프라 비용
- 높은 가용성, 규모 확장성, 안정성
- 다양한 지원 클라이언트

<br>

## 비디오 업로드

<img src="https://github.com/dahyen0o/development-books/assets/64001680/1db0edb3-e7c0-4865-a1f8-0b4b31659762" width="60%">

### 프로세스 A: 비디오 업로드

> 1. 비디오를 원본 저장소에 업로드한다.
> 2. 트랜스코딩 서버는 원본 저장소에서 해당 비디오를 가져와 트랜스코딩을 시작한다.
> 3. 트랜스코딩이 완료되면 아래 두 절차가 병렬젹으로 수행된다. <br>
>   a. 트랜스코딩이 끝난 비디오를 CDN에 올린다. <br>
>   b. 완료 핸들러가 이벤트 데이터를 큐에서 꺼낸다. <br>
>   b.1. 완료 핸들러가 메타데이터 데이터베이스와 캐시를 갱신한다. <br>
> 4. API 서버가 스트리밍 준비가 되었음을 단말에게 알린다.

### 프로세스 B: 메타데이터 갱신

단말은 병렬적으로 비디오 메타데이터(파일 이름, 크기, 포맷 등) 갱신 요청을 API 서버에 보낸다.

<br>

## 비디오 스트리밍

<img src="https://github.com/dahyen0o/development-books/assets/64001680/9bf6cd7c-fe9b-4b70-a99b-528537bae1da" width="30%">

### 스트리밍 프로토콜 (streaming protocol)

> 비디오 스트리밍을 위해 데이터를 전송할 때 쓰이는 표준화된 통신방법

프로토콜마다 지원하는 비디오 인코딩과 플레이어가 다르다.

### 비디오 트랜스코딩

> 비디오를 다른 단말과 호환되는 `비트레이트(bitrate)` 와 `포맷` 으로 저장하기 위해 변환하는 과정

- 비트레이트: 비디오를 구성하는 비트가 얼마나 빨리 처리되어야 하는지를 나타내는 단위
- 포맷: `컨테이너` (비디오 파일, 오디오, 메타데이터를 담는 바구니) + `코덱` (codec, 비디오 화질은 보존하면서 파일 크기는 줄이는 압축 및 압축 해제 알고리즘)

#### 아키텍처

<img src="https://github.com/dahyen0o/development-books/assets/64001680/8e089a4c-b6a8-4e19-9280-8f9fdbff388d" width="60%"> 

- DAG(유향 비순환 그래프) 모델: 클라이언트 프로그래머가 작업(task)을 손수 정의할 수 있게 추상화된 비디오 프로세싱 파이프라인

<br>

## 시스템 최적화

### 속도 최적화: 비디오 병렬 업로드

> 하나의 비디오를 여러 GOP(Group of Pictures)로 분할해 병렬적으로 업로드한다.

- 일부가 실패해도 빠르게 재개할 수 있어 업로드 속도가 증가한다.

### 속도 최적화: 업로드 센터를 사용자 근거리에 지정

> 업로드 센터를 여러 곳에 둔다.

### 속도 최적화: 모든 절차를 병렬화

> 메세지 큐를 사용해 느슨하게 결합된 시스템을 만든다.

### 안정성 최적화: 미리 사인된 업로드 URL

1. 클라이언트가 API 서버에 요청하여 `미리 사인된 URL` 을 받는다.
2. 클라이언트는 해당 URL이 가리키는 위치에 비디오를 업로드 한다.

### 안정성 최적화: 비디오 보호

- 디지털 저작권 관리(DRM: Digital Rights Management) 시스템 도입
- AES 암호화(encryption): 비디오를 암호화하고 접근 권한을 설정한다. 비디오는 재생 시에만 복호화한다.
- 워터마크(watermark): 비디오 위에 소유자 정보를 포함하는 이미지 오버레이를 올린다.

### 비용 최적화

> 유튜브의 비디오 스트리밍이 `롱테일(long-tail, 인기 있는 비디오만 빈번히 재생됨) 분포` 를 따르는 것에 착안해 CDN을 효율적으로 사용하도록 한다.

- 인기 비디오는 CDN을, 다른 비디오는 비디오 서버를 통해 재생한다.
- 인기가 없는 짧은 비디오는 필요할 때만 인코딩하여 재생한다.
- CDN을 직접 구축하고 인터넷 서비스 제공자(ISP: Internet Service Provider)와 제휴한다.

### 오류 처리

> 장애를 잘 감내하는(highly fault-tolerant) 시스템을 만든다.

