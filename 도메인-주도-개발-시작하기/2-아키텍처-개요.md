### 계층 구조 아키텍처

|영역|역할|
|---|---|
|표현|요청을 응용 영역이 필요로 하는 형식으로 `변환` 해서 응용 영역에 전달하고, 응답을 알맞게 변환해 전송한다.|
|응용|시스템이 사용자에게 제공해야 할 기능을 구현한다. <br> 도메인 모델에 `로직 수행을 위임` 한다.|
|도메인|도메인 모델을 구현하고, 도메인의 핵심 로직을 구현한다.|
|인프라스트럭처|실제 `구현 기술` 을 다룬다.|

#### 특징

> 표현 → 응용 → 도메인 → 인프라스트럭처

상위에서 하위 계층으로의 의존만 존재한다.

> 표현 → 응용 → 도메인 → 인프라스트럭처 <br>
  표현 → 응용 → 인프라스트럭처

구현의 편리함을 위해 계층 구조를 유연하게 적용하기도 한다.

#### 문제

표현, 응용, 도메인 계층이 상세한 구현 기술을 다루는 인프라스트럭처 계층에 `종속` 된다.
- `테스트` 하기 어렵다.
- `구현 방식` 을 변경하기 어렵다.

<br>

### DIP (Dependency Inversion Principle)

저수준 모듈이 고수준 모듈에 의존하도록 의존성을 역전시킨다. <br>
→ 추상화한 `인터페이스` 사용

#### 주의사항

단순히 인터페이스와 구현클래스를 분리하는 것이 아니다. 

<img src="https://github.com/anti-fragile-study/DDD-start-study/assets/64001680/f7869ae1-6603-4a26-b490-44153043f2a0" width="500">

<br> 도메인 영역이 인프라스트럭처 영역에 의존하고 있으므로 여전히 고수준 모듈이 저수준 모듈에 의존하고 있다.

#### 아키텍처 변화

> 인프라스트럭처 → 도메인 → 응용 <br>
  인프라스트럭처 → 응용

<br>

### 도메인 영역

|요소|설명|
|---|---|
|엔티티(Entity)|`고유의 식별자` 를 갖는 객체로 자신의 라이프 사이클을 갖는다. <br> 도메인의 고유한 개념을 표현한다.|
|밸류(Value)|고유의 식별자를 갖지 않는 객체로 개념적으로 하나인 값을 표현할 때 사용된다.|
|애그리거트(Aggregate)|연관된 엔티티와 밸류 객체를 개념적으로 하나로 묶은 것이다.|
|리포지터리(Repository)|도메인 모델의 `영속성` 을 처리한다.|
|도메인 서비스(Domain Service)|특정 엔티티에 속하지 않은 도메인 로직을 제공한다.|

#### 엔티티와 밸류

도메인 모델의 엔티티와 DB 관계형 모델의 엔티티는 같지 않다.

- 도메인 모델의 엔티티는 데이터와 함께 도메인 기능을 함께 제공한다,.
- 도메인 모델의 엔티티는 `밸류 타입` 을 이용해서 표현할 수 있다.

#### 애그리거트

- 관련 객체를 하나로 묶은 `군집` <br>
  → 도메인 모델에서 전체 구조를 이해하는 데 도움이 된다.

- 군집에 속한 객체를 관리하는 `루트 엔티티` 를 가진다. <br>
  → 애그리거트 루트를 통해서만 다른 객체에 접근할 수 있어 `애그리거트 단위로 캡슐화` 할 수 있도록 돕는다.

#### 리포지터리

- 구현을 위한 도메인 모델이다.
- 애그리거트 단위로 도메인 객체를 저장하고 조회하는 기능을 정의한다.
- `응용 서비스` 와 리포지토리는 밀접한 연관이 있다.
  - 응용 서비스는 필요한 도메인 객체를 구하거나 저장할 때 리포지토리를 사용한다.
  - 응용 서비스는 `트랜잭션` 을 관리하는데, 트랜잭션 처리는 리포지터리 구현 기술의 영향을 받는다.
 
<br>

### 인프라스트럭처 영역

DIP로 무조건 인프라스트럭처에 대한 의존을 없앨 필요는 없다.

```java
@Transactional
public class Application {
}

@Entity
public class Entity {
}
```

`구현의 편리함`은 DIP가 주는 장점만큼 중요하기 때문에 <br>
위와 같이 `DIP의 장점(변경의 유연함, 쉬운 테스트)` 을 해치치 않는 범위에서 의존을 가져가도 괜찮다.
